<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Parser (emile.Emile.Parser)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0-342-g7e488de"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../../index.html">emile</a> &#x00BB; <a href="../index.html">Emile</a> &#x00BB; Parser</nav><header><h1>Module <code>Emile.Parser</code></h1></header><div class="content"><aside><p>This is an aggregation of rules used to parse an e-mail address. The goal of this documentation is to show relations between RFCs, updates, and final description of parts needed to parse an e-mail address.</p><p>Obviously, this part is most a copy-paste from RFCs to explain what we implement. And for a client, it's a boring and indigestible (but needed) work. We provide implementations only for people know what they really need — and avoid duplicate code in some ways.</p><p>But the biggest advise about this module is just to ignore it and move on — like what I really want when I wrote this documentation.</p></aside><div><div class="spec value" id="val-is_vchar" class="anchored"><a href="#val-is_vchar" class="anchor"></a><code><span class="keyword">val</span> is_vchar : char <span>&#45;&gt;</span> bool</code></div><div><p>From <a href="https://tools.ietf.org/html/rfc5234#appendix-B.1">RFC5234</a> (used in <a href="https://tools.ietf.org/html/rfc5322#section-3.1">RFC5322</a>).</p><pre><code>VCHAR = %x21-7E ; visible (printing) characters</code></pre></div></div><div><div class="spec value" id="val-is_obs_no_ws_ctl" class="anchored"><a href="#val-is_obs_no_ws_ctl" class="anchor"></a><code><span class="keyword">val</span> is_obs_no_ws_ctl : char <span>&#45;&gt;</span> bool</code></div><div><p>From <a href="https://tools.ietf.org/html/rfc5322#section-4.1">RFC5322</a>.</p><pre><code>obs-NO-WS-CTL = %d1-8 /   ; US-ASCII control
                %d11 /    ;  characters that do not
                %d12 /    ;  include the carriage
                %d14-31 / ;  return, line feed, and
                %d127     ;  white space characters</code></pre></div></div><div><div class="spec value" id="val-is_ctext" class="anchored"><a href="#val-is_ctext" class="anchor"></a><code><span class="keyword">val</span> is_ctext : char <span>&#45;&gt;</span> bool</code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>ctext = &lt;any CHAR excluding &quot;(&quot;,          ; =&gt; may be folded
         &quot;)&quot;, BACKSLASH &amp; CR, &amp; including
         linear-white-space&gt;</code></pre><p>From <a href="https://tools.ietf.org/html/rfc1522">RFC1522</a> (occurrences).</p><pre><code>5. Use of encoded-words in message headers

  (2) An encoded-word may appear within a comment delimited by &quot;(&quot; and
      &quot;)&quot;, i.e., wherever a &quot;ctext&quot; is allowed.  More precisely, the
      RFC 822 ABNF definition for &quot;comment&quot; is amended as follows:

      comment = &quot;(&quot; *(ctext / quoted-pair / comment / encoded-word) &quot;)&quot;

      A &quot;Q&quot;-encoded encoded-word which appears in a comment MUST NOT
      contain the characters &quot;(&quot;, &quot;)&quot; or DQUOTE encoded-word that
      appears in a &quot;comment&quot; MUST be separated from any adjacent
      encoded-word or &quot;ctext&quot; by linear-white-space.

7. Conformance

  A mail reading program claiming compliance with this specification
  must be able to distinguish encoded-words from &quot;text&quot;, &quot;ctext&quot;, or
  &quot;word&quot;s, according to the rules in section 6, anytime they appear in
  appropriate places in message headers.  It must support both the &quot;B&quot;
  and &quot;Q&quot; encodings for any character set which it supports.  The
  program must be able to display the unencoded text if the character</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2047">RFC2047</a> § Appendix.</p><pre><code>+ clarification: an 'encoded-word' may appear immediately following
  the initial &quot;(&quot; or immediately before the final &quot;)&quot; that delimits a
  comment, not just adjacent to &quot;(&quot; and &quot;)&quot; *within* *ctext.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.1">RFC2822</a>.</p><pre><code>ctext = NO-WS-CTL / ; Non white space controls
        %d33-39 /   ; The rest of the US-ASCII
        %d42-91 /   ;  characters not including &quot;(&quot;,
        %d93-126    ;  &quot;)&quot;, or BACKSLASH</code></pre><p>From <a href="https://tools.ietf.org/rfc5322#section-3.2.2">RFC5322</a>.</p><pre><code>ctext     = %d33-39 /     ; Printable US-ASCII
            %d42-91 /     ;  characters not including
            %d93-126 /    ;  &quot;(&quot;, &quot;)&quot;, or BACKSLASH
            obs-ctext
obs-ctext = obs-NO-WS-CTL

Update from RFC 2822
+ Removed NO-WS-CTL from ctext</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5335#section-4.3">RFC5335</a>.</p><pre><code>ctext          =/ UTF8-xtra-char
UTF8-xtra-char =  UTF8-2 / UTF8-3 / UTF8-4
UTF8-2         =  %xC2-DF UTF8-tail
UTF8-3         =  %xE0 %xA0-BF UTF8-tail /
                  %xE1-EC 2(UTF8-tail) /
                  %xED %x80-9F UTF8-tail /
                  %xEE-EF 2(UTF8-tail)
UTF8-4         =  %xF0 %x90-BF 2( UTF8-tail ) /
                  %xF1-F3 3( UTF8-tail ) /
                  %xF4 %x80-8F 2( UTF8-tail )
UTF8-tail      =  %x80-BF</code></pre><p>From <a href="https://tools.ietf.org/html/rfc6532#section-3.2">RFC6532</a>.</p><pre><code>ctext =/ UTF8-non-ascii</code></pre><p><b>Note about UTF-8, the process is out of this scope where we check only one byte here.</b> <b>Note about compliance with RFC1522, it's out of scope where we check only one byte here.</b></p></div></div><div><div class="spec value" id="val-is_qtext" class="anchored"><a href="#val-is_qtext" class="anchor"></a><code><span class="keyword">val</span> is_qtext : char <span>&#45;&gt;</span> bool</code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>qtext = &lt;any CHAR excepting DQUOTE,    ; =&gt; may be folded
         BACKSLASH &amp; CR, and including
         linear-white-space&gt;</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.5">RFC2822</a>.</p><pre><code>qtext = NO-WS-CTL / ; Non white space controls
        %d33 /      ; The rest of the US-ASCII
        %d35-91 /   ;  characters not including BACKSLASH
        %d93-126    ;  or the quote character</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.4">RFC5322</a>.</p><pre><code>qtext     = %d33 /        ; Printable US-ASCII
            %d35-91 /     ;  characters not including
            %d93-126 /    ;  BACKSLASH or the quote character
            obs-qtext
obs-qtext = obs-NO-WS-CTL</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5335#section-4.3">RFC5335</a> (see <a href="index.html#val-is_ctext"><code>is_ctext</code></a> about <code>UTF-xtra-char</code>).</p><pre><code>utf8-qtext = qtext / UTF8-xtra-char</code></pre><p>From <a href="https://tools.ietf.org/html/rfc6532#section-3.2">RFC6532</a>.</p><pre><code>qtext =/ UTF8-non-ascii</code></pre><p><b>Note about UTF-8, the process is out of this scope where we check only one byte here.</b></p></div></div><div><div class="spec value" id="val-is_atext" class="anchored"><a href="#val-is_atext" class="anchor"></a><code><span class="keyword">val</span> is_atext : char <span>&#45;&gt;</span> bool</code></div><div><p>The ABNF of <code>atext</code> is not explicit from RFC822 but the relic could be find <a href="https://tools.ietf.org/html/rfc822#section-3.3">here</a>.</p><pre><code>atom = 1*&lt;any CHAR except specials, SPACE and CTLs&gt;</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.4">RFC2822</a>.</p><pre><code>atext = ALPHA / DIGIT / ; Any character except controls,
        &quot;!&quot; / &quot;#&quot; /     ;  SP, and specials.
        &quot;$&quot; / &quot;%&quot; /     ;  Used for atoms
        &quot;&amp;&quot; / &quot;'&quot; /
        &quot;*&quot; / &quot;+&quot; /
        &quot;-&quot; / &quot;/&quot; /
        &quot;=&quot; / &quot;?&quot; /
        &quot;^&quot; / &quot;_&quot; /
        &quot;`&quot; / &quot;{&quot; /
        &quot;|&quot; / &quot;}&quot; /
        &quot;~&quot;</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.3">RFC5322</a>.</p><pre><code>atext = ALPHA / DIGIT / ; Printable US-ASCII
        &quot;!&quot; / &quot;#&quot; /     ;  characters not including
        &quot;$&quot; / &quot;%&quot; /     ;  specials.  Used for atoms.
        &quot;&amp;&quot; / &quot;'&quot; /
        &quot;*&quot; / &quot;+&quot; /
        &quot;-&quot; / &quot;/&quot; /
        &quot;=&quot; / &quot;?&quot; /
        &quot;^&quot; / &quot;_&quot; /
        &quot;`&quot; / &quot;{&quot; /
        &quot;|&quot; / &quot;}&quot; /
        &quot;~&quot;</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5335#section-3.2.4">RFC535</a> (see <a href="index.html#val-is_ctext"><code>is_ctext</code></a> about <code>UTF-xtra-char</code>).</p><pre><code>utf8-atext = ALPHA / DIGIT /
             &quot;!&quot; / &quot;#&quot; /     ; Any character except
             &quot;$&quot; / &quot;%&quot; /     ; controls, SP, and specials.
             &quot;&amp;&quot; / &quot;'&quot; /     ; Used for atoms.
             &quot;*&quot; / &quot;+&quot; /
             &quot;-&quot; / &quot;/&quot; /
             &quot;=&quot; / &quot;?&quot; /
             &quot;^&quot; / &quot;_&quot; /
             &quot;`&quot; / &quot;{&quot; /
             &quot;|&quot; / &quot;}&quot; /
             &quot;~&quot; /
             UTF8-xtra-char</code></pre><p>From <a href="https://tools.ietf.org/html/rfc6532#section-3.2">RFC6532</a>.</p><pre><code>atext =/ UTF8-non-ascii</code></pre><p><b>Note about, UTF-8, the process is out of this scope where we check only byte here.</b></p></div></div><div><div class="spec value" id="val-is_wsp" class="anchored"><a href="#val-is_wsp" class="anchor"></a><code><span class="keyword">val</span> is_wsp : char <span>&#45;&gt;</span> bool</code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>LWSP-char = SPACE / HTAB ; semantics = SPACE</code></pre><p>From RFC2882 and RFC5322, we did not find any occurrence of LWSP-char. It replaced by WSP (available on <a href="https://tools.ietf.org/html/rfc5234#appendix-B.1">RFC5234</a>).</p></div></div><div><div class="spec value" id="val-is_quoted_pair" class="anchored"><a href="#val-is_quoted_pair" class="anchor"></a><code><span class="keyword">val</span> is_quoted_pair : char <span>&#45;&gt;</span> bool</code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>quoted-pair = BACKSLASH CHAR ; may quote any char
CHAR is case-sensitive</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.2">RFC2822</a>.</p><pre><code>quoted-pair = (BACKSLASH text) / obs-qp
text        = %d1-9 /                     ; Characters excluding CR and LF
              %d11 /
              %d12 /
              %d14-127 /
              obs-text
obs-text    = *LF *CR *(obs-char *LF *CR)
obs-char    = %d0-9 / %d11 /              ; %d0-127 except CR and
              %d12 / %d14-127             ;  LF
obs-qp      = BACKSLASH (%d0-127)</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.1">RFC5322</a>.</p><pre><code>quoted-pair = (BACKSLASH (VCHAR / WSP)) / obs-qp
obs-qp      = BACKSLASH (%d0 / obs-NO-WS-CTL / LF / CR)</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5335#section-4.3">RFC5335</a> (see <a href="index.html#val-is_ctext"><code>is_ctext</code></a> about <code>UTF-xtra-char</code>).</p><pre><code>utf8-text        = %d1-9 /         ; all UTF-8 characters except
                   %d11-12 /       ; US-ASCII NUL, CR, and LF
                   %d14-127 /
                   UTF8-xtra-char
utf8-quoted-pair = (BACKSLASH utf8-text) / obs-qp</code></pre><p><b>Note this function is <code>fun _chr -&gt; true</code>.</b> <b>Note RFC5322 (last version of e-mail) does not mention an update from RFC2822. RFC6532 does not mention an update of <code>quoted-pair</code>. This implemention follow RFC5322 <b>without</b> unicode support.</b></p></div></div><div><div class="spec value" id="val-is_dtext" class="anchored"><a href="#val-is_dtext" class="anchor"></a><code><span class="keyword">val</span> is_dtext : char <span>&#45;&gt;</span> bool</code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>dtext = &lt;any CHAR excluding &quot;[&quot;,          ; =&gt; may be folded
         &quot;]&quot;, BACKSLASH &amp; CR, &amp; including
         linear-white-space&gt;</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.4.1">RFC2822</a>.</p><pre><code>dtext = NO-WS-CTL / ; Non white space controls

        %d33-90 /   ; The rest of the US-ASCII
        %d94-126    ;  characters not including &quot;[&quot;,
                    ;  &quot;]&quot;, or BACKSLASH</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.4.1">RFC5322</a>.</p><pre><code>+ Removed NO-WS-CTL from dtext

dtext     = %d33-90 /                   ; Printable US-ASCII
            %d94-126 /                  ;  characters not including
            obs-dtext                   ;  &quot;[&quot;, &quot;]&quot;, or BACKSLASH
obs-dtext = obs-NO-WS-CTL / quoted-pair</code></pre><p><b>Note <code>quoted-pair</code> can not be processed here where we handle only one byte.</b></p></div></div><div><div class="spec value" id="val-quoted_pair" class="anchored"><a href="#val-quoted_pair" class="anchor"></a><code><span class="keyword">val</span> quoted_pair : <span>char <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>See <a href="index.html#val-is_quoted_pair"><code>is_quoted_pair</code></a>.</p></div></div><div><div class="spec value" id="val-fws" class="anchored"><a href="#val-fws" class="anchor"></a><code><span class="keyword">val</span> fws : <span><span>(bool * bool * bool)</span> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.2.1">RFC822</a>.</p><pre><code>Each header field can be viewed as a single, logical  line  of
ASCII  characters,  comprising  a field-name and a field-body.
For convenience, the field-body  portion  of  this  conceptual
entity  can be split into a multiple-line representation; this
is called &quot;folding&quot;.  The general rule is that wherever  there
may  be  linear-white-space  (NOT  simply  LWSP-chars), a CRLF
immediately followed by AT LEAST one LWSP-char may instead  be
inserted.  Thus, the single line

    To:  &quot;Joe &amp; J. Harvey&quot; &lt;ddd @Org&gt;, JJV @ BBN

can be represented as:

    To:  &quot;Joe &amp; J. Harvey&quot; &lt;ddd @ Org&gt;,
            JJV@BBN

and

    To:  &quot;Joe &amp; J. Harvey&quot;
                    &lt;ddd@ Org&gt;, JJV
     @BBN

and

    To:  &quot;Joe &amp;
     J. Harvey&quot; &lt;ddd @ Org&gt;, JJV @ BBN

     The process of moving  from  this  folded   multiple-line
representation  of a header field to its single line represen-
tation is called &quot;unfolding&quot;.  Unfolding  is  accomplished  by
regarding   CRLF   immediately  followed  by  a  LWSP-char  as
equivalent to the LWSP-char.

Note:  While the standard  permits  folding  wherever  linear-
       white-space is permitted, it is recommended that struc-
       tured fields, such as those containing addresses, limit
       folding  to higher-level syntactic breaks.  For address
       fields, it  is  recommended  that  such  folding  occur
       between addresses, after the separating comma.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.3">RFC2822 § 3.2.3</a> &amp; <a href="https://tools.ietf.org/html/rfc2822#section-4.2">RFC2822 § 4.2</a>.</p><pre><code>White space characters, including white space used in folding
(described in section 2.2.3), may appear between many elements in
header field bodies.  Also, strings of characters that are treated as
comments may be included in structured field bodies as characters
enclosed in parentheses.  The following defines the folding white
space (FWS) and comment constructs.

Strings of characters enclosed in parentheses are considered comments
so long as they do not appear within a &quot;quoted-string&quot;, as defined in
section 3.2.5.  Comments may nest.

There are several places in this standard where comments and FWS may
be freely inserted.  To accommodate that syntax, an additional token
for &quot;CFWS&quot; is defined for places where comments and/or FWS can occur.
However, where CFWS occurs in this standard, it MUST NOT be inserted
in such a way that any line of a folded header field is made up
entirely of WSP characters and nothing else.

FWS = ([*WSP CRLF] 1*WSP) /   ; Folding white space
      obs-FWS

In the obsolete syntax, any amount of folding white space MAY be
inserted where the obs-FWS rule is allowed.  This creates the
possibility of having two consecutive &quot;folds&quot; in a line, and
therefore the possibility that a line which makes up a folded header
field could be composed entirely of white space.

obs-FWS = 1*WSP *(CRLF 1*WSP)</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.2">RFC5322 § 3.2.2</a> &amp; <a href="https://tools.ietf.org/rfc5322#section-4.2">RFC322 § 4.2</a>.</p><pre><code>White space characters, including white space used in folding
(described in section 2.2.3), may appear between many elements in
header field bodies.  Also, strings of characters that are treated as
comments may be included in structured field bodies as characters
enclosed in parentheses.  The following defines the folding white
space (FWS) and comment constructs.

Strings of characters enclosed in parentheses are considered comments
so long as they do not appear within a &quot;quoted-string&quot;, as defined in
section 3.2.4.  Comments may nest.

There are several places in this specification where comments and FWS
may be freely inserted.  To accommodate that syntax, an additional
token for &quot;CFWS&quot; is defined for places where comments and/or FWS can
occur.  However, where CFWS occurs in this specification, it MUST NOT
be inserted in such a way that any line of a folded header field is
made up entirely of WSP characters and nothing else.

FWS = ([*WSP CRLF] 1*WSP) / obs-FWS ; Folding white space

In the obsolete syntax, any amount of folding white space MAY be
inserted where the obs-FWS rule is allowed.  This creates the
possibility of having two consecutive &quot;folds&quot; in a line, and
therefore the possibility that a line which makes up a folded header
field could be composed entirely of white space.

obs-FWS = 1*WSP *(CRLF 1*WSP)</code></pre><p><b>NOTE</b> <code>FWS</code> token is a part of an email content and it does not correspond to real/usual input like form input. Implementation discard, by implementation, it where something else must handle folding whitespace.</p><p><code>unstrctrd</code> is a library which handles <code>FWS</code> but <code>emile</code> just wants to parse correctly an email address (either if it comes from an email or not). At the end, <code>emile</code> <b>is not</b> compliant to RFC822.</p></div></div><div><div class="spec value" id="val-comment" class="anchored"><a href="#val-comment" class="anchor"></a><code><span class="keyword">val</span> comment : <span>unit <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>comment = &quot;(&quot; *(ctext / quoted-pair / comment) &quot;)&quot;</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.3">RFC2822</a>.</p><pre><code>ccontent = ctext / quoted-pair / comment
comment  = &quot;(&quot; *([FWS] ccontent) [FWS] &quot;)&quot;</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.2">RFC5322</a>.</p><pre><code>ccontent = ctext / quoted-pair / comment
comment  = &quot;(&quot; *([FWS] ccontent) [FWS] &quot;)&quot;</code></pre></div></div><div><div class="spec value" id="val-cfws" class="anchored"><a href="#val-cfws" class="anchor"></a><code><span class="keyword">val</span> cfws : <span>unit <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From RFC822, see <a href="index.html#val-fws"><code>fws</code></a> and <code>obs_fws</code>.</p><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.3">RFC2822</a>.</p><pre><code>CFWS = *([FWS] comment) (([FWS] comment) / FWS)</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.2">RFC5322</a>.</p><pre><code>CFWS = (1*([FWS] comment) [FWS]) / FWS

Update from RFC 2822:
+ Simplified CFWS syntax.</code></pre></div></div><div><div class="spec value" id="val-qcontent" class="anchored"><a href="#val-qcontent" class="anchor"></a><code><span class="keyword">val</span> qcontent : <span>string <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>quoted-string = DQUOTE *(qtext/quoted-pair) DQUOTE ; Regular qtext or
                                                   ;   quoted chars.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.5">RFC2822</a>.</p><pre><code>qcontent = qtext / quoted-pair</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.4">RFC5322</a>.</p><pre><code>qcontent = qtext / quoted-pair</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5335#section-4.3">RFC5355</a>.</p><pre><code>utf8-qcontent = utf8-qtext / utf8-quoted-pair
qcontent = utf8-qcontent</code></pre></div></div><div><div class="spec value" id="val-quoted_string" class="anchored"><a href="#val-quoted_string" class="anchor"></a><code><span class="keyword">val</span> quoted_string : <span>string <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>quoted-string = DQUOTE *(qtext/quoted-pair) DQUOTE ; Regular qtext or
                                                   ;   quoted chars.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2047">RFC2047</a>.</p><pre><code>+ An 'encoded-word' MUST NOT appear within a 'quoted-string'</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822">RFC2822</a>.</p><pre><code>quoted-string = [CFWS]
                DQUOTE *([FWS] qcontent) [FWS] DQUOTE
                [CFWS]

A quoted-string is treated as a unit.  That is, quoted-string is
identical to atom, semantically.  Since a quoted-string is allowed to
contain FWS, folding is permitted.  Also note that since quoted-pair
is allowed in a quoted-string, the quote and backslash characters may
appear in a quoted-string so long as they appear as a quoted-pair.

Semantically, neither the optional CFWS outside of the quote
characters nor the quote characters themselves are part of the
quoted-string; the quoted-string is what is contained between the two
quote characters.  As stated earlier, the BACKSLASH in any quoted-pair
and the CRLF in any FWS/CFWS that appears within the quoted-string are
semantically &quot;invisible&quot; and therefore not part of the quoted-string
either.</code></pre><p><b>Note in other words, space(s) in <code>FWS</code> are &quot;visible&quot; between DQUOTE.</b></p><p>From <a href="https://tools.ietf.org">RFC5322</a>.</p><pre><code>quoted-string = [CFWS]
                DQUOTE *([FWS] qcontent) [FWS] DQUOTE
                [CFWS]</code></pre><p><b>Note currenlty, this implementation has a bug about multiple spaces in <code>quoted-string</code>. We need to update <a href="index.html#val-fws"><code>fws</code></a> to count how many space(s) we skip.</b></p></div></div><div><div class="spec value" id="val-atom" class="anchored"><a href="#val-atom" class="anchor"></a><code><span class="keyword">val</span> atom : <span>string <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>atom = 1*&lt;any CHAR except specials, SPACE and CTLs&gt;

Difference from RFC 733:
- Atoms may not contain SPACE.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.4">RFC2822</a>.</p><pre><code>atom = [CFWS] 1*atext [CFWS]</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.3">RFC5322</a>.</p><pre><code>atom = [CFWS] 1*atext [CFWS]</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5335#section-4.3">RFC5335</a>.</p><pre><code>utf8-atom = [CFWS] 1*utf8-atext [CFWS]</code></pre></div></div><div><div class="spec value" id="val-word" class="anchored"><a href="#val-word" class="anchor"></a><code><span class="keyword">val</span> word : <span><a href="../index.html#type-word">word</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>word = atom / quoted-string</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.6">RFC2822</a>.</p><pre><code>word = atom / quoted-string</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.5">RFC5322</a>.</p><pre><code>word = atom / quoted-string</code></pre></div></div><div><div class="spec value" id="val-dot_atom_text" class="anchored"><a href="#val-dot_atom_text" class="anchor"></a><code><span class="keyword">val</span> dot_atom_text : <span><span>string list</span> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.4">RFC2822</a>.</p><pre><code>dot-atom-text = 1*atext *(&quot;.&quot; 1*atext)</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.3">RFC5322</a>.</p><pre><code>dot-atom-text = 1*atext *(&quot;.&quot; 1*atext)</code></pre></div></div><div><div class="spec value" id="val-dot_atom" class="anchored"><a href="#val-dot_atom" class="anchor"></a><code><span class="keyword">val</span> dot_atom : <span><span>string list</span> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.4">RFC2822</a>.</p><pre><code>dot-atom = [CFWS] dot-atom-text [CFWS]</code></pre><p>From <a href="https://tools.ietf.org/rfc5322#section-3.2.3">RFC5322</a>.</p><pre><code>dot-atom = [CFWS] dot-atom-text [CFWS]</code></pre></div></div><div><div class="spec value" id="val-local_part" class="anchored"><a href="#val-local_part" class="anchor"></a><code><span class="keyword">val</span> local_part : <span><a href="../index.html#type-local">local</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-">RFC822</a>.</p><pre><code>local-part = word *(&quot;.&quot; word) ; uninterpreted
                              ; case-preserved

The local-part of an  addr-spec  in  a  mailbox  specification
(i.e.,  the  host's  name for the mailbox) is understood to be
whatever the receiving mail protocol server allows.  For exam-
ple,  some systems do not understand mailbox references of the
form &quot;P. D. Q. Bach&quot;, but others do.

This specification treats periods (&quot;.&quot;) as lexical separators.
Hence,  their  presence  in  local-parts which are not quoted-
strings, is detected.   However,  such  occurrences  carry  NO
semantics.  That is, if a local-part has periods within it, an
address parser will divide the local-part into several tokens,
but  the  sequence  of  tokens will be treated as one uninter-
preted unit.  The sequence  will  be  re-assembled,  when  the
address is passed outside of the system such as to a mail pro-
tocol service.

For example, the address:

                   First.Last@Registry.Org

is legal and does not require the local-part to be  surrounded
with  quotation-marks.   (However,  &quot;First  Last&quot; DOES require
quoting.)  The local-part of the address, when passed  outside
of  the  mail  system,  within  the  Registry.Org  domain,  is
&quot;First.Last&quot;, again without quotation marks.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.4.1">RFC2822 § 3.4.1</a> &amp; <a href="https://tools.ietf.org/html/rfc2822#section-4.4">RFC2822 § 4.4</a>.</p><pre><code>local-part = dot-atom / quoted-string / obs-local-part
obs-local-part = word *(&quot;.&quot; word)

The local-part portion is a domain dependent string.  In addresses,
it is simply interpreted on the particular host as a name of a
particular mailbox.

Update:
+ CFWS within local-parts and domains not allowed.*</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.4.1">RFC5322 § 3.4.1</a> &amp; <a href="https://tools.ietf.org/html/rfc5322#section-4.4">RFC5322 § 4.4</a>.</p><pre><code>local-part = dot-atom / quoted-string / obs-local-part
obs-local-part = word *(&quot;.&quot; word)</code></pre></div></div><div><div class="spec value" id="val-obs_local_part" class="anchored"><a href="#val-obs_local_part" class="anchor"></a><code><span class="keyword">val</span> obs_local_part : <span><a href="../index.html#type-local">local</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>See <a href="index.html#val-local_part"><code>local_part</code></a>.</p></div></div><div><div class="spec value" id="val-domain_literal" class="anchored"><a href="#val-domain_literal" class="anchor"></a><code><span class="keyword">val</span> domain_literal : <span>string <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>domain-literal = &quot;[&quot; *(dtext / quoted-pair) &quot;]&quot;

o   Square brackets (&quot;[&quot; and &quot;]&quot;) are used to indicate the
    presence  of  a  domain-literal, which the appropriate
    name-domain  is  to  use  directly,  bypassing  normal
    name-resolution mechanisms.

Domain-literals which refer to domains within the ARPA  Inter-
net  specify  32-bit  Internet addresses, in four 8-bit fields
noted in decimal, as described in Request for  Comments  #820,
&quot;Assigned Numbers.&quot;  For example:

                         [10.0.3.19]

Note:  THE USE OF DOMAIN-LITERALS IS STRONGLY DISCOURAGED.  It
       is  permitted  only  as  a means of bypassing temporary
       system limitations, such as name tables which  are  not
       complete.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.4.1">RFC2822</a>.</p><pre><code>domain-literal = [CFWS] &quot;[&quot; *([FWS] dcontent) [FWS] &quot;]&quot; [CFWS]</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.4.1">RFC5322</a>.</p><pre><code>domain-literal = [CFWS] &quot;[&quot; *([FWS] dtext) [FWS] &quot;]&quot; [CFWS]</code></pre></div></div><div class="spec value" id="val-obs_domain" class="anchored"><a href="#val-obs_domain" class="anchor"></a><code><span class="keyword">val</span> obs_domain : <span><span>string list</span> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><div class="spec value" id="val-domain" class="anchored"><a href="#val-domain" class="anchor"></a><code><span class="keyword">val</span> domain : <span><a href="../index.html#type-domain">domain</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-6.1">RFC822 § 6.1</a>, <a href="https://tools.ietf.org/html/rfc822#section-6.2.1">RFC822 § 6.2.1</a>, <a href="https://tools.ietf.org/html/rfc822#section-6.2.2">RFC822 § 6.2.2</a> &amp; <a href="https://tools.ietf.org/html/rfc822#section-6.2.3">RFC822 § 6.2.3</a>.</p><pre><code>domain = sub-domain *(&quot;.&quot; sub-domain)
sub-domain = domain-ref / domain-literal
domain-ref = atom                        ; symbolic reference

6.2.1.  DOMAINS

A name-domain is a set of registered (mail)  names.   A  name-
domain  specification  resolves  to  a subordinate name-domain
specification  or  to  a  terminal  domain-dependent   string.
Hence,  domain  specification  is  extensible,  permitting any
number of registration levels.

Name-domains model a global, logical, hierarchical  addressing
scheme.   The  model is logical, in that an address specifica-
tion is related to name registration and  is  not  necessarily
tied  to  transmission  path.   The  model's  hierarchy  is  a
directed graph, called an in-tree, such that there is a single
path  from  the root of the tree to any node in the hierarchy.
If more than one path actually exists, they are considered  to
be different addresses.

The root node is common to all addresses; consequently, it  is
not  referenced.   Its  children  constitute &quot;top-level&quot; name-
domains.  Usually, a service has access to its own full domain
specification and to the names of all top-level name-domains.

The &quot;top&quot; of the domain addressing hierarchy -- a child of the
root  --  is  indicated  by  the right-most field, in a domain
specification.  Its child is specified to the left, its  child
to the left, and so on.

Some groups provide formal registration services;  these  con-
stitute   name-domains   that  are  independent  logically  of
specific machines.  In addition, networks and machines  impli-
citly  compose name-domains, since their membership usually is
registered in name tables.

In the case of formal registration, an organization implements
a  (distributed)  data base which provides an address-to-route
mapping service for addresses of the form:

                 person@registry.organization

Note that &quot;organization&quot; is a logical  entity,  separate  from
any particular communication network.

A mechanism for accessing &quot;organization&quot; is universally avail-
able.   That mechanism, in turn, seeks an instantiation of the
registry; its location is not indicated in the address specif-
ication.   It  is assumed that the system which operates under
the name &quot;organization&quot; knows how to find a subordinate regis-
try.  The registry will then use the &quot;person&quot; string to deter-
mine where to send the mail specification.

The latter,  network-oriented  case  permits  simple,  direct,
attachment-related address specification, such as:

                      user@host.network

Once the network is accessed, it is expected  that  a  message
will  go  directly  to the host and that the host will resolve
the user name, placing the message in the user's mailbox.

6.2.2.  ABBREVIATED DOMAIN SPECIFICATION

Since any number of  levels  is  possible  within  the  domain
hierarchy,  specification  of  a  fully  qualified address can
become inconvenient.  This standard permits abbreviated domain
specification, in a special case:

    For the address of  the  sender,  call  the  left-most
    sub-domain  Level  N.   In a header address, if all of
    the sub-domains above (i.e., to the right of) Level  N
    are  the same as those of the sender, then they do not
    have to appear in the specification.   Otherwise,  the
    address must be fully qualified.

    This feature is subject  to  approval  by  local  sub-
    domains.   Individual  sub-domains  may  require their
    member systems, which originate mail, to provide  full
    domain  specification only.  When permitted, abbrevia-
    tions may be present  only  while  the  message  stays
    within the sub-domain of the sender.

    Use of this mechanism requires the sender's sub-domain
    to reserve the names of all top-level domains, so that
    full specifications can be distinguished from abbrevi-
    ated specifications.

For example, if a sender's address is:

         sender@registry-A.registry-1.organization-X

and one recipient's address is:

        recipient@registry-B.registry-1.organization-X

and another's is:

        recipient@registry-C.registry-2.organization-X

then &quot;.registry-1.organization-X&quot; need not be specified in the
the  message,  but  &quot;registry-C.registry-2&quot;  DOES  have  to be
specified.  That is, the first two addresses may  be  abbrevi-
ated, but the third address must be fully specified.

When a message crosses a domain boundary, all  addresses  must
be  specified  in  the  full format, ending with the top-level
name-domain in the right-most field.  It is the responsibility
of  mail  forwarding services to ensure that addresses conform
with this requirement.  In the case of abbreviated  addresses,
the  relaying  service must make the necessary expansions.  It
should be noted that it often is difficult for such a  service
to locate all occurrences of address abbreviations.  For exam-
ple, it will not be possible to find such abbreviations within
the  body  of  the  message.   The &quot;Return-Path&quot; field can aid
recipients in recovering from these errors.

Note:  When passing any portion of an addr-spec onto a process
       which  does  not interpret data according to this stan-
       dard (e.g., mail protocol servers).  There must  be  NO
       LWSP-chars  preceding  or  following the at-sign or any
       delimiting period (&quot;.&quot;), such as  shown  in  the  above
       examples,   and   only  ONE  SPACE  between  contiguous
       &lt;word&gt;s.

6.2.3.  DOMAIN TERMS

A domain-ref must be THE official name of a registry, network,
or  host.   It  is  a  symbolic  reference, within a name sub-
domain.  At times, it is necessary to bypass standard  mechan-
isms  for  resolving  such  references,  using  more primitive
information, such as a network host address  rather  than  its
associated host name.

To permit such references, this standard provides the  domain-
literal  construct.   Its contents must conform with the needs
of the sub-domain in which it is interpreted.

Domain-literals which refer to domains within the ARPA  Inter-
net  specify  32-bit  Internet addresses, in four 8-bit fields
noted in decimal, as described in Request for  Comments  #820,
&quot;Assigned Numbers.&quot;  For example:

                         [10.0.3.19]

Note:  THE USE OF DOMAIN-LITERALS IS STRONGLY DISCOURAGED.  It
       is  permitted  only  as  a means of bypassing temporary
       system limitations, such as name tables which  are  not
       complete.

The names of &quot;top-level&quot; domains, and  the  names  of  domains
under  in  the  ARPA Internet, are registered with the Network
Information Center, SRI International, Menlo Park, California.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.4.1">RFC2822 § 3.4.1</a> &amp; <a href="https://tools.ietf.org/html/rfc2822#section-4.4">RFC2822 § 4.4</a>.</p><pre><code>domain = dot-atom / domain-literal / obs-domain
obs-domain = atom *(&quot;.&quot; atom)</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.4.1">RFC5322 § 3.4.1</a> &amp; <a href="https://tools.ietf.org/html/rfc5322#section-4.4">RFC5322 § 4.4</a>.</p><pre><code>domain = dot-atom / domain-literal / obs-domain
obs-domain = atom *(&quot;.&quot; atom)</code></pre><p><b>Note from RFC5322, we should accept any domain as <code>`Literal</code> and let the</b> user to resolve it. Currently, we fail when we catch a <code>`Literal</code> and do the best effort where we follow RFC5321. But may be it's inconvenient (or not?) to fail.</p></div></div><div><div class="spec value" id="val-id_left" class="anchored"><a href="#val-id_left" class="anchor"></a><code><span class="keyword">val</span> id_left : <span><a href="../index.html#type-local">local</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.6.4">RFC2822 § 3.6.4</a> &amp; <a href="https://tools.ietf.org/html/rfc2822#section-4.5.4">RFC2822 § 4.5.4</a>.</p><pre><code>obs-id-left = local-part
no-fold-quote = DQUOTE *(qtext / quoted-pair) DQUOTE
id-left = dot-atom-text / no-fold-quote / obs-id-left</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.6.4">RFC5322 § 3.6.4</a> &amp; <a href="https://tools.ietf.org/html/rfc5322#section-4.5.4">RFC5322 § 4.5.4</a>.</p><pre><code>id-left = dot-atom-text / obs-id-left
obs-id-left = local-part</code></pre></div></div><div><div class="spec value" id="val-no_fold_literal" class="anchored"><a href="#val-no_fold_literal" class="anchor"></a><code><span class="keyword">val</span> no_fold_literal : <span>string <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.6.4">RFC2822</a>.</p><pre><code>no-fold-literal = &quot;[&quot; *(dtext / quoted-pair) &quot;]&quot;</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.6.4">RFC5322</a>.</p><pre><code>no-fold-literal = &quot;[&quot; *dtext &quot;]&quot;</code></pre></div></div><div><div class="spec value" id="val-id_right" class="anchored"><a href="#val-id_right" class="anchor"></a><code><span class="keyword">val</span> id_right : <span><a href="../index.html#type-domain">domain</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.6.4">RFC2822 § 3.6.4</a> &amp; <a href="https://tools.ietf.org/html/rfc2822#section-4.5.4">RFC2822 § 4.5.4</a>.</p><pre><code>id-right = dot-atom-text / no-fold-literal / obs-id-right
obs-id-right = domain</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.6.4">RFC5322 § 3.6.4</a> &amp; <a href="https://tools.ietf.org/html/rfc5322#section-4.5.4">RFC5322 § 4.5.4</a>.</p><pre><code>id-right = dot-atom-text / no-fold-literal / obs-id-right
obs-id-right = domain</code></pre></div></div><div><div class="spec value" id="val-msg_id" class="anchored"><a href="#val-msg_id" class="anchor"></a><code><span class="keyword">val</span> msg_id : <span><span>(<a href="../index.html#type-local">local</a> * <a href="../index.html#type-domain">domain</a>)</span> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-4.1">RFC822 § 4.1</a> &amp; <a href="https://tools.ietf.org/html/rfc822#section-6.1">RFC822 § 6.1</a>.</p><pre><code>addr-spec = local-part &quot;@&quot; domain ; global address
msg-id = &quot;&lt;&quot; addr-spec &quot;&gt;&quot; ; Unique message id</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.6.4">RFC2822</a>.</p><pre><code>msg-id = [CFWS] &quot;&lt;&quot; id-left &quot;@&quot; id-right &quot;&gt;&quot; [CFWS]

Update:
+ CFWS within msg-id not allowed.*

The message identifier (msg-id) is similar in syntax to an angle-addr
construct without the internal CFWS.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.6.4">RFC5322</a>.</p><pre><code>msg-id = [CFWS] &quot;&lt;&quot; id-left &quot;@&quot; id-right &quot;&gt;&quot; [CFWS]

Update:
+ Removed no-fold-quote from msg-id.  Clarified syntax

The message identifier (msg-id) itself MUST be a globally unique
identifier for a message.  The generator of the message identifier
MUST guarantee that the msg-id is unique.  There are several
algorithms that can be used to accomplish this.  Since the msg-id has
a similar syntax to addr-spec (identical except that quoted strings,
comments, and folding white space are not allowed), a good method is
to put the domain name (or a domain literal IP address) of the host
on which the message identifier was created on the right-hand side of
the &quot;@&quot; (since domain names and IP addresses are normally unique),
and put a combination of the current absolute date and time along
with some other currently unique (perhaps sequential) identifier
available on the system (for example, a process id number) on the
left-hand side.  Though other algorithms will work, it is RECOMMENDED
that the right-hand side contain some domain identifier (either of
the host itself or otherwise) such that the generator of the message
identifier can guarantee the uniqueness of the left-hand side within
the scope of that domain.

Semantically, the angle bracket characters are not part of the
msg-id; the msg-id is what is contained between the two angle bracket
characters.</code></pre></div></div><div><div class="spec value" id="val-addr_spec" class="anchored"><a href="#val-addr_spec" class="anchor"></a><code><span class="keyword">val</span> addr_spec : <span><a href="../index.html#type-mailbox">mailbox</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-6.1">RFC822</a>.</p><pre><code>addr-spec = local-part &quot;@&quot; domain ; global address</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.4.1">RFC2822</a>.</p><pre><code>An addr-spec is a specific Internet identifier that contains a
locally interpreted string followed by the at-sign character (&quot;@&quot;,
ASCII value 64) followed by an Internet domain.  The locally
interpreted string is either a quoted-string or a dot-atom.  If the
string can be represented as a dot-atom (that is, it contains no
characters other than atext characters or &quot;.&quot; surrounded by atext
characters), then the dot-atom form SHOULD be used and the
quoted-string form SHOULD NOT be used. Comments and folding white
space SHOULD NOT be used around the &quot;@&quot; in the addr-spec.

addr-spec = local-part &quot;@&quot; domain</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.4.1">RFC5322</a>.</p><pre><code>Note: A liberal syntax for the domain portion of addr-spec is
given here.  However, the domain portion contains addressing
information specified by and used in other protocols (e.g.,
[RFC1034], [RFC1035], [RFC1123], [RFC5321]).  It is therefore
incumbent upon implementations to conform to the syntax of
addresses for the context in which they are used.

addr-spec = local-part &quot;@&quot; domain</code></pre></div></div><div><div class="spec value" id="val-angle_addr" class="anchored"><a href="#val-angle_addr" class="anchor"></a><code><span class="keyword">val</span> angle_addr : <span><a href="../index.html#type-mailbox">mailbox</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-6.1">RFC822</a>.</p><p>The ABNF of <code>angle-addr</code> is not explicit from RFC 822 but the relic could be find here, as a part of mailbox:</p><pre><code>mailbox =  addr-spec         ; simple address
        /  phrase route-addr ; name &amp; addr-spec</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2882#section-3.4">RFC2822 § 3.4</a> &amp; <a href="https://tools.ietf.org/html/rfc2822#section-4.4">RFC2822 § 4.4</a>.</p><pre><code>obs-domain-list = &quot;@&quot; domain *( *(CFWS / &quot;,&quot; ) [CFWS] &quot;@&quot; domain)
obs-route = [CFWS] obs-domain-list &quot;:&quot; [CFWS]
obs-angle-addr = [CFWS] &quot;&lt;&quot; [obs-route] addr-spec &quot;&gt;&quot; [CFWS]
angle-addr = [CFWS] &quot;&lt;&quot; addr-spec &quot;&gt;&quot; [CFWS] / obs-angle-addr</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section#section-3.4">RFC5322 § 3.4</a> &amp; <a href="https://tools.ietf.org/html/rfc5322#section-4.4">RFC5322 § 4.4</a>.</p><pre><code>obs-domain-list = *(CFWS / &quot;,&quot;) &quot;@&quot; domain
                  *(&quot;,&quot; [CFWS] [&quot;@&quot; domain])
obs-route = obs-domain-list &quot;:&quot;
obs-angle-addr = [CFWS] &quot;&lt;&quot; obs-route addr-spec &quot;&gt;&quot; [CFWS]
angle-addr = [CFWS] &quot;&lt;&quot; addr-spec &quot;&gt;&quot; [CFWS] /</code></pre></div></div><div><div class="spec value" id="val-obs_domain_list" class="anchored"><a href="#val-obs_domain_list" class="anchor"></a><code><span class="keyword">val</span> obs_domain_list : <span><span><a href="../index.html#type-domain">domain</a> list</span> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>See <a href="index.html#val-angle_addr"><code>angle_addr</code></a>.</p></div></div><div><div class="spec value" id="val-obs_route" class="anchored"><a href="#val-obs_route" class="anchor"></a><code><span class="keyword">val</span> obs_route : <span><span><a href="../index.html#type-domain">domain</a> list</span> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>See <a href="index.html#val-angle_addr"><code>angle_addr</code></a>.</p></div></div><div><div class="spec value" id="val-obs_angle_addr" class="anchored"><a href="#val-obs_angle_addr" class="anchor"></a><code><span class="keyword">val</span> obs_angle_addr : <span><a href="../index.html#type-mailbox">mailbox</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>See <a href="index.html#val-angle_addr"><code>angle_addr</code></a>.</p></div></div><div><div class="spec value" id="val-phrase" class="anchored"><a href="#val-phrase" class="anchor"></a><code><span class="keyword">val</span> phrase : <span><a href="../index.html#type-phrase">phrase</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-3.3">RFC822</a>.</p><pre><code>phrase = 1*word ; Sequence of words</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2047#section-2">RFC2047 § 2</a> &amp; <a href="https://tools.ietf.org/html/rfc2047#section-5">RFC2047 § 5</a>.</p><pre><code>(3) As a replacement for a 'word' entity within a 'phrase', for example,
    one that precedes an address in a From, To, or Cc header.  The ABNF
    definition for 'phrase' from RFC 822 thus becomes:

    phrase = 1*( encoded-word / word )

    In this case the set of characters that may be used in a &quot;Q&quot;-encoded
    'encoded-word' is restricted to: &lt;upper and lower case ASCII
    letters, decimal digits, &quot;!&quot;, &quot;*&quot;, &quot;+&quot;, &quot;-&quot;, &quot;/&quot;, &quot;=&quot;, and &quot;_&quot;
    (underscore, ASCII 95.)&gt;.  An 'encoded-word' that appears within a
    'phrase' MUST be separated from any adjacent 'word', 'text' or
    'special' by 'linear-white-space'.

encoded-word = &quot;=?&quot; charset &quot;?&quot; encoding &quot;?&quot; encoded-text &quot;?=&quot;
charset = token    ; see section 3
encoding = token   ; see section 4
token = 1*&lt;Any CHAR except SPACE, CTLs, and especials&gt;
especials = &quot;(&quot; / &quot;)&quot; / &quot;&lt;&quot; / &quot;&gt;&quot; / &quot;@&quot; / &quot;,&quot; / &quot;;&quot; / &quot;:&quot; / &quot;
            &lt;&quot;&gt; / &quot;/&quot; / &quot;[&quot; / &quot;]&quot; / &quot;?&quot; / &quot;.&quot; / &quot;=&quot;
encoded-text = 1*&lt;Any printable ASCII character other than &quot;?&quot;
                  or SPACE&gt;
               ; (but see &quot;Use of encoded-words in message
               ; headers&quot;, section 5)</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.2.6">RFC2822 § 3.2.6</a> &amp; <a href="https://tools.ietf.org/html/rfc2822#section-4.1">RFC2822 § 4.1</a>.</p><pre><code>obs-phrase = word *(word / &quot;.&quot; / CFWS)
phrase = 1*word / obs-phrase

Update:
+ Period allowed in obsolete form of phrase.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.2.5">RFC5322 § 3.2.5</a> &amp; <a href="https://tools.ietf.org/html/rfc5322#section-4.1">RFC5322 § 4.1</a>.</p><pre><code>phrase = 1*word / obs-phrase

Note: The &quot;period&quot; (or &quot;full stop&quot;) character (&quot;.&quot;) in obs-phrase
is not a form that was allowed in earlier versions of this or any
other specification.  Period (nor any other character from
specials) was not allowed in phrase because it introduced a
parsing difficulty distinguishing between phrases and portions of
an addr-spec (see section 4.4).  It appears here because the
period character is currently used in many messages in the
display-name portion of addresses, especially for initials in
names, and therefore must be interpreted properly.

obs-phrase = word *(word / &quot;.&quot; / CFWS)</code></pre></div></div><div><div class="spec value" id="val-obs_phrase" class="anchored"><a href="#val-obs_phrase" class="anchor"></a><code><span class="keyword">val</span> obs_phrase : <span><a href="../index.html#type-phrase">phrase</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>See <a href="index.html#val-phrase"><code>phrase</code></a>.</p></div></div><div><div class="spec value" id="val-display_name" class="anchored"><a href="#val-display_name" class="anchor"></a><code><span class="keyword">val</span> display_name : <span><a href="../index.html#type-phrase">phrase</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-6.1">RFC822</a>.</p><pre><code>mailbox =  addr-spec         ; simple address
        /  phrase route-addr ; name &amp; addr-spec</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.4">RFC2822</a>.</p><pre><code>display-name = phrase
name-addr = [display-name] angle-addr

Note: Some legacy implementations used the simple form where the
addr-spec appears without the angle brackets, but included the name
of the recipient in parentheses as a comment following the addr-spec.
Since the meaning of the information in a comment is unspecified,
implementations SHOULD use the full name-addr form of the mailbox,
instead of the legacy form, to specify the display name associated
with a mailbox.  Also, because some legacy implementations interpret
the comment, comments generally SHOULD NOT be used in address fields
to avoid confusing such implementations.</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.4">RFC5322</a>.</p><pre><code>name-addr = [display-name] angle-addr
display-name = phrase</code></pre></div></div><div><div class="spec value" id="val-mailbox" class="anchored"><a href="#val-mailbox" class="anchor"></a><code><span class="keyword">val</span> mailbox : <span><a href="../index.html#type-mailbox">mailbox</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc822#section-6.1">RFC822</a>.</p><pre><code>mailbox =  addr-spec         ; simple address
        /  phrase route-addr ; name &amp; addr-spec</code></pre><p>From <a href="https://tools.ietf.org/html/rfc2822#section-3.4">RFC2822</a>.</p><pre><code>mailbox = name-addr / addr-spec</code></pre><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.4">RFC5322</a>.</p><pre><code>mailbox = name-addr / addr-spec</code></pre></div></div><div><div class="spec value" id="val-mailbox_list" class="anchored"><a href="#val-mailbox_list" class="anchor"></a><code><span class="keyword">val</span> mailbox_list : <span><span><a href="../index.html#type-mailbox">mailbox</a> list</span> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div><p>From <a href="https://tools.ietf.org/html/rfc5322#section-3.4">RFC5322</a>.</p><pre><code>obs-mbox-list = *([CFWS] &quot;,&quot;) mailbox *(&quot;,&quot; [mailbox / CFWS])
mailbox-list = (mailbox *(&quot;,&quot; mailbox)) / obs-mbox-list</code></pre></div></div><aside><p>/</p></aside><div class="spec value" id="val-group" class="anchored"><a href="#val-group" class="anchor"></a><code><span class="keyword">val</span> group : <span><a href="../index.html#type-group">group</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div class="spec value" id="val-address" class="anchored"><a href="#val-address" class="anchor"></a><code><span class="keyword">val</span> address : <span><a href="../index.html#type-t">t</a> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><div class="spec value" id="val-address_list" class="anchored"><a href="#val-address_list" class="anchor"></a><code><span class="keyword">val</span> address_list : <span><span><a href="../index.html#type-t">t</a> list</span> <span class="xref-unresolved">Angstrom</span>.t</span></code></div><aside><p>/</p></aside></div></body></html>